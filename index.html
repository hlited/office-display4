<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilingual Office Display - Updated</title>
    <style>
        :root { --main-blue: #003366; --line-color: #d1e7ff; }
        body, html { margin: 0; padding: 0; width: 1080px; height: 1920px; font-family: "Microsoft JhengHei", "Arial", sans-serif; overflow: hidden; background: #fff; }
        
        /* 頂部 Header */
        header { 
            height: 180px; display: flex; justify-content: space-between; align-items: center; 
            padding: 0 60px; border-bottom: 8px solid var(--main-blue); 
        }
        .logo img { height: 80px; width: auto; object-fit: contain; }
        .clock-box { text-align: right; }
        #time { font-size: 85px; font-weight: 900; color: var(--main-blue); line-height: 1; }
        #date { font-size: 32px; color: #666; font-weight: bold; }

        /* 內容區 */
        .viewport { position: relative; height: 1740px; }
        .section { position: absolute; width: 100%; height: 100%; transition: opacity 1.5s ease-in-out; opacity: 0; }
        .section.active { opacity: 1; }

        /* 標題區域 */
        .title { padding: 60px 60px 30px; color: var(--main-blue); }
        .title .zh { font-size: 68px; font-weight: bold; display: block; }
        .title .en { font-size: 36px; font-weight: normal; color: #555; text-transform: uppercase; letter-spacing: 2px; }

        /* 表格設計：加寬地點與負責人欄位 */
        table { width: 960px; margin: 0 auto; border-collapse: collapse; table-layout: fixed; }
        th { border-bottom: 4px solid var(--main-blue); padding: 30px 10px; text-align: left; vertical-align: bottom; }
        th .zh { font-size: 42px; display: block; color: #000; }
        th .en { font-size: 24px; font-weight: normal; color: #666; display: block; }
        
        td { padding: 50px 10px; border-bottom: 1px solid #eee; font-size: 42px; word-wrap: break-word; color: #333; }
        .location-tag { color: #0066cc; font-weight: bold; background: #e7f2ff; padding: 10px 20px; border-radius: 12px; display: inline-block; }
        
        .no-data { text-align: center; padding: 200px; color: #bbb; }
        .no-data .zh { font-size: 56px; display: block; margin-bottom: 15px; }
        .no-data .en { font-size: 32px; display: block; }

        #poster-img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

<header>
    <div class="logo"><img src="logo.png" onerror="this.src='https://via.placeholder.com/300x80?text=LOGO'"></div>
    <div class="clock-box">
        <div id="date">--/--/--</div>
        <div id="time">00:00</div>
    </div>
</header>

<div class="viewport">
    <div id="schedule-sec" class="section active">
        <div class="title">
            <span class="zh">今日預約安排</span>
            <span class="en">Daily Schedule</span>
        </div>
        <table>
            <thead>
                <tr>
                    <th width="28%">
                        <span class="zh">時間</span><span class="en">Time</span>
                    </th>
                    <th width="42%">
                        <span class="zh">地點</span><span class="en">Location</span>
                    </th>
                    <th width="30%">
                        <span class="zh">負責人</span><span class="en">In-charge</span>
                    </th>
                </tr>
            </thead>
            <tbody id="data-list">
                <tr><td colspan="3" class="no-data"><span class="zh">正在讀取...</span><span class="en">Loading...</span></td></tr>
            </tbody>
        </table>
    </div>
    
    <div id="poster-sec" class="section">
        <img id="poster-img" src="">
    </div>
</div>

<script>
    // --- 更新後的 CSV 網址 ---
    // 工作表1 (自動推算)
    const scheduleUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQcXft1rOplV2fP2kvm81qdI3gJ4iLaRjX-SsnIwsxRALBwfDvfQtjk8_HWJEdDe0G83oTZHeiLcdwp/pub?gid=0&single=true&output=csv';
    // Posters 分頁
    const posterUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQcXft1rOplV2fP2kvm81qdI3gJ4iLaRjX-SsnIwsxRALBwfDvfQtjk8_HWJEdDe0G83oTZHeiLcdwp/pub?gid=6573573&single=true&output=csv';

    let posters = [];
    let pIdx = 0;

    function updateTime() {
        const now = new Date();
        const zhDate = now.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        const enDate = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', weekday: 'short' });
        document.getElementById('date').innerHTML = `${zhDate} <br> ${enDate}`;
        document.getElementById('time').innerText = now.toLocaleTimeString('zh-TW', {hour: '2-digit', minute:'2-digit', hour12: false});
    }
    setInterval(updateTime, 1000);

    async function loadData() {
        try {
            // 抓取海報連結
            const pRes = await fetch(posterUrl + '&cache=' + Date.now());
            const pText = await pRes.text();
            posters = pText.split('\n').slice(1).map(l => l.trim()).filter(l => l.length > 10);

            // 抓取活動表格
            const sRes = await fetch(scheduleUrl + '&cache=' + Date.now());
            const sText = await sRes.text();
            const rows = sText.split(/\r?\n/).map(r => r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
            
            const tbody = document.getElementById('data-list');
            tbody.innerHTML = '';
            
            const today = new Date();
            const todayStr = `${String(today.getDate()).padStart(2,'0')}/${String(today.getMonth()+1).padStart(2,'0')}/${String(today.getFullYear()).slice(-2)}`;

            let found = false;
            rows.slice(1).forEach(row => {
                const date = row[0] ? row[0].replace(/["']/g, "").trim() : "";
                if(date === todayStr) {
                    found = true;
                    // row[1]=時間, row[3]=地點, row[4]=負責人 (跳過 row[2] 活動)
                    tbody.innerHTML += `<tr>
                        <td>${row[1]}</td>
                        <td><span class="location-tag">${row[3]}</span></td>
                        <td>${row[4]}</td>
                    </tr>`;
                }
            });
            if(!found) {
                tbody.innerHTML = `<tr><td colspan="3" class="no-data">
                    <span class="zh">今日暫無預約活動</span>
                    <span class="en">No activities scheduled for today</span>
                    <small style="font-size:24px; color:#ccc; display:block; margin-top:10px;">${todayStr}</small>
                </td></tr>`;
            }
        } catch(e) { console.error("Update failed:", e); }
    }

    function switchMode() {
        const sSec = document.getElementById('schedule-sec');
        const pSec = document.getElementById('poster-sec');
        
        if (sSec.classList.contains('active') && posters.length > 0) {
            sSec.classList.remove('active');
            pSec.classList.add('active');
            document.getElementById('poster-img').src = posters[pIdx];
            pIdx = (pIdx + 1) % posters.length;
            setTimeout(switchMode, 15000); // 海報 15 秒
        } else {
            pSec.classList.remove('active');
            sSec.classList.add('active');
            setTimeout(switchMode, 30000); // 表格 30 秒
        }
    }

    loadData();
    setInterval(loadData, 600000); // 10分鐘同步一次
    updateTime();
    switchMode();
</script>
</body>
</html>
